<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C++ CP IDE</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/dracula.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/monokai.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/solarized.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/closebrackets.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Fira+Code&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0c1021; }
        .CodeMirror { height: 100%; font-family: 'Fira Code', monospace; font-size: 15px; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-thumb { background: #44475a; border-radius: 4px; }
        .template-btn { transition: all 0.2s; text-align: left; }
        .template-btn:hover { background-color: #374151; transform: translateX(4px); }
        .template-group { margin-top: 15px; margin-bottom: 5px; color: #6b7280; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; padding-left: 4px; }
    </style>
</head>
<body class="text-white flex flex-col h-screen overflow-hidden">
    
    <header class="bg-[#111827] border-b border-gray-700 p-3 flex justify-between items-center z-10 shrink-0 shadow-lg">
        <div class="flex items-center gap-2">
            <h1 class="text-lg font-bold text-gray-200">CP Workspace</h1>
        </div>
        <div class="flex gap-3">
            <button id="theme-btn" class="bg-gray-700 hover:bg-gray-600 px-4 py-1.5 rounded text-sm transition-colors">Theme</button>
            <button id="run-btn" class="bg-green-600 hover:bg-green-500 px-6 py-1.5 rounded font-bold shadow-md transition-all flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/></svg>
                Run
            </button>
        </div>
    </header>

    <div class="flex flex-grow overflow-hidden p-2 gap-2">
        
        <aside class="w-60 bg-[#111827] rounded-lg border border-gray-700 flex flex-col shrink-0 overflow-hidden">
            <div class="p-3 border-b border-gray-700 font-semibold text-gray-300">Templates</div>
            <div class="overflow-y-auto p-2 space-y-1">
                
                <div class="template-group">Basics</div>
                <button onclick="setTemplate('empty')" class="template-btn w-full px-3 py-2 rounded text-sm text-gray-300 hover:text-white bg-[#1f2937] border border-gray-600">
                    Empty Boilerplate
                </button>
                <button onclick="setTemplate('array')" class="template-btn w-full px-3 py-2 rounded text-sm text-gray-300 hover:text-white bg-[#1f2937] border border-gray-600">
                    Input Array (n)
                </button>
                <button onclick="setTemplate('grid')" class="template-btn w-full px-3 py-2 rounded text-sm text-gray-300 hover:text-white bg-[#1f2937] border border-gray-600">
                    Input Grid (nxm)
                </button>

                <div class="template-group">Number Theory</div>
                <button onclick="setTemplate('nCr')" class="template-btn w-full px-3 py-2 rounded text-sm text-gray-300 hover:text-white bg-[#1f2937] border border-gray-600">
                    Factorial & nCr
                </button>
                <button onclick="setTemplate('modulo')" class="template-btn w-full px-3 py-2 rounded text-sm text-gray-300 hover:text-white bg-[#1f2937] border border-gray-600">
                    Modular Exponentiation
                </button>
                <button onclick="setTemplate('primes')" class="template-btn w-full px-3 py-2 rounded text-sm text-gray-300 hover:text-white bg-[#1f2937] border border-gray-600">
                    Sieve (Primes)
                </button>

                <div class="template-group">Graphs / DSU</div>
                <button onclick="setTemplate('dsu')" class="template-btn w-full px-3 py-2 rounded text-sm text-gray-300 hover:text-white bg-[#1f2937] border border-gray-600">
                    DSU (Disjoint Set)
                </button>
                <button onclick="setTemplate('bfs')" class="template-btn w-full px-3 py-2 rounded text-sm text-gray-300 hover:text-white bg-[#1f2937] border border-gray-600">
                    Graph + BFS
                </button>
            </div>
        </aside>

        <div class="flex flex-col flex-grow w-0 bg-[#1e1e1e] rounded-lg border border-gray-700 overflow-hidden">
            <div class="p-2 bg-[#1a202c] text-sm text-gray-400 flex justify-between">
                <span>main.cpp</span>
                <button id="copy-btn" class="hover:text-white">Copy</button>
            </div>
            <div class="flex-grow relative">
                <textarea id="code-editor"></textarea>
            </div>
        </div>

        <div class="flex flex-col w-1/3 gap-2 shrink-0">
            <div class="flex flex-col h-1/2 bg-[#1e1e1e] rounded-lg border border-gray-700 overflow-hidden">
                <div class="p-2 bg-[#1a202c] text-sm text-gray-400">Input</div>
                <textarea id="input-box" class="w-full h-full p-3 bg-[#111827] text-gray-200 resize-none outline-none font-mono text-sm"></textarea>
            </div>
            <div class="flex flex-col h-1/2 bg-[#1e1e1e] rounded-lg border border-gray-700 overflow-hidden">
                <div class="p-2 bg-[#1a202c] text-sm text-gray-400 flex justify-between">
                    <span>Output</span>
                    <span id="status" class="text-xs px-2 py-0.5 rounded-full"></span>
                </div>
                <pre id="output-box" class="w-full h-full p-3 bg-[#111827] text-gray-200 overflow-auto font-mono text-sm whitespace-pre-wrap"></pre>
            </div>
        </div>
    </div>

    <script>
        // 1. Initialize Editor
        const editor = CodeMirror.fromTextArea(document.getElementById('code-editor'), {
            mode: "text/x-c++src",
            theme: "dracula",
            lineNumbers: true,
            autoCloseBrackets: true,
            indentUnit: 4,
            tabSize: 4
        });

        // 2. Define FULL Templates (Replacing entire file)
        const templates = {
            'empty': `#include <bits/stdc++.h>
using namespace std;

#define ll long long

void solve() {
    
}

int main() {
    ios_base::sync_with_stdio(false);
    cin.tie(NULL);
    
    int t;
    cin >> t;
    while(t--) {
        solve();
    }
    return 0;
}`,

            'array': `#include <bits/stdc++.h>
using namespace std;

#define ll long long

void solve() {
    int n;
    cin >> n;
    vector<int> a(n);
    for(int i = 0; i < n; i++) {
        cin >> a[i];
    }
    
    // Logic here
    
}

int main() {
    ios_base::sync_with_stdio(false);
    cin.tie(NULL);
    
    int t;
    cin >> t;
    while(t--) {
        solve();
    }
    return 0;
}`,

            'grid': `#include <bits/stdc++.h>
using namespace std;

#define ll long long

void solve() {
    int n, m;
    cin >> n >> m;
    vector<vector<int>> grid(n, vector<int>(m));
    for(int i = 0; i < n; i++) {
        for(int j = 0; j < m; j++) {
            cin >> grid[i][j];
        }
    }
    
}

int main() {
    ios_base::sync_with_stdio(false);
    cin.tie(NULL);
    
    int t;
    cin >> t;
    while(t--) {
        solve();
    }
    return 0;
}`,

            'nCr': `#include <bits/stdc++.h>
using namespace std;

#define ll long long
const int MOD = 1e9 + 7;
const int MAXN = 2e5 + 5;

ll fact[MAXN], invFact[MAXN];

ll binpow(ll base, ll exp) {
    ll res = 1;
    while (exp > 0) {
        if (exp % 2 == 1) res = (res * base) % MOD;
        base = (base * base) % MOD;
        exp /= 2;
    }
    return res;
}

void precompute() {
    fact[0] = 1;
    invFact[0] = 1;
    for (int i = 1; i < MAXN; i++) {
        fact[i] = (fact[i - 1] * i) % MOD;
        invFact[i] = binpow(fact[i], MOD - 2);
    }
}

ll nCr(int n, int r) {
    if (r < 0 || r > n) return 0;
    return fact[n] * invFact[r] % MOD * invFact[n - r] % MOD;
}

void solve() {
    int n, r;
    cin >> n >> r;
    cout << nCr(n, r) << "\\n";
}

int main() {
    ios_base::sync_with_stdio(false);
    cin.tie(NULL);
    
    precompute(); // Run once
    
    int t;
    cin >> t;
    while(t--) {
        solve();
    }
    return 0;
}`,

            'modulo': `#include <bits/stdc++.h>
using namespace std;

#define ll long long
const int MOD = 1e9 + 7;

ll binpow(ll base, ll exp) {
    ll res = 1;
    while (exp > 0) {
        if (exp % 2 == 1) res = (res * base) % MOD;
        base = (base * base) % MOD;
        exp /= 2;
    }
    return res;
}

ll modInverse(ll n) {
    return binpow(n, MOD - 2);
}

void solve() {
    ll a, b;
    cin >> a >> b;
    // Example: (a^b) % MOD
    cout << binpow(a, b) << "\\n";
}

int main() {
    ios_base::sync_with_stdio(false);
    cin.tie(NULL);
    
    int t;
    cin >> t;
    while(t--) {
        solve();
    }
    return 0;
}`,

            'dsu': `#include <bits/stdc++.h>
using namespace std;

#define ll long long

struct DSU {
    vector<int> parent, size;
    DSU(int n) {
        parent.resize(n + 1);
        size.resize(n + 1, 1);
        iota(parent.begin(), parent.end(), 0);
    }
    int find(int x) {
        if (parent[x] == x) return x;
        return parent[x] = find(parent[x]);
    }
    void unite(int x, int y) {
        int rootX = find(x);
        int rootY = find(y);
        if (rootX != rootY) {
            if (size[rootX] < size[rootY]) swap(rootX, rootY);
            parent[rootY] = rootX;
            size[rootX] += size[rootY];
        }
    }
};

void solve() {
    int n, m;
    cin >> n >> m;
    
    DSU dsu(n);
    
    for(int i=0; i<m; ++i) {
        int u, v;
        cin >> u >> v;
        dsu.unite(u, v);
    }
}

int main() {
    ios_base::sync_with_stdio(false);
    cin.tie(NULL);
    
    int t;
    cin >> t;
    while(t--) {
        solve();
    }
    return 0;
}`,
            'primes': `#include <bits/stdc++.h>
using namespace std;

#define ll long long
const int MAXN = 1e6 + 5;
vector<bool> is_prime(MAXN, true);

void sieve() {
    is_prime[0] = is_prime[1] = false;
    for (int i = 2; i * i < MAXN; i++) {
        if (is_prime[i]) {
            for (int j = i * i; j < MAXN; j += i)
                is_prime[j] = false;
        }
    }
}

void solve() {
    int n;
    cin >> n;
    if(is_prime[n]) cout << "YES\\n";
    else cout << "NO\\n";
}

int main() {
    ios_base::sync_with_stdio(false);
    cin.tie(NULL);
    
    sieve();
    
    int t;
    cin >> t;
    while(t--) {
        solve();
    }
    return 0;
}`,
            'bfs': `#include <bits/stdc++.h>
using namespace std;

#define ll long long

void solve() {
    int n, m;
    cin >> n >> m; // Nodes, Edges
    vector<vector<int>> adj(n + 1);
    
    for(int i = 0; i < m; i++) {
        int u, v;
        cin >> u >> v;
        adj[u].push_back(v);
        adj[v].push_back(u);
    }
    
    // BFS Example
    vector<int> dist(n + 1, -1);
    queue<int> q;
    
    q.push(1);
    dist[1] = 0;
    
    while(!q.empty()) {
        int u = q.front();
        q.pop();
        
        for(int v : adj[u]) {
            if(dist[v] == -1) {
                dist[v] = dist[u] + 1;
                q.push(v);
            }
        }
    }
}

int main() {
    ios_base::sync_with_stdio(false);
    cin.tie(NULL);
    
    int t;
    cin >> t;
    while(t--) {
        solve();
    }
    return 0;
}`
        };

        // 3. Set Template Function (Replaces all content)
        function setTemplate(key) {
            editor.setValue(templates[key]);
            editor.clearHistory(); // Clear undo history so Ctrl+Z doesn't mix templates
        }

        // Initialize with default
        setTemplate('empty');

        // --- Helper: Copy Button ---
        document.getElementById('copy-btn').addEventListener('click', () => {
            navigator.clipboard.writeText(editor.getValue());
            const btn = document.getElementById('copy-btn');
            btn.textContent = 'Copied!';
            setTimeout(() => btn.textContent = 'Copy', 1500);
        });

        // --- Helper: Theme Toggle ---
        const themeBtn = document.getElementById('theme-btn');
        const themes = ['dracula', 'monokai', 'solarized light'];
        let currentThemeIdx = 0;
        themeBtn.addEventListener('click', () => {
            currentThemeIdx = (currentThemeIdx + 1) % themes.length;
            editor.setOption('theme', themes[currentThemeIdx]);
            themeBtn.textContent = `Theme: ${themes[currentThemeIdx]}`;
        });

        // --- API Execution Logic ---
        const runBtn = document.getElementById('run-btn');
        const statusSpan = document.getElementById('status');
        const outputBox = document.getElementById('output-box');
        
        runBtn.addEventListener('click', async () => {
            const source = editor.getValue();
            const inp = document.getElementById('input-box').value;
            
            runBtn.disabled = true;
            runBtn.classList.add('opacity-50', 'cursor-not-allowed');
            runBtn.innerHTML = 'Running...';
            statusSpan.textContent = '';
            outputBox.textContent = '';

            try {
                const response = await fetch('https://judge0-ce.p.rapidapi.com/submissions?base64_encoded=true&wait=true', {
                    method: 'POST',
                    headers: {
                        'content-type': 'application/json',
                        'x-rapidapi-host': 'judge0-ce.p.rapidapi.com',
                        'x-rapidapi-key': 'ab79e2474cmshf8e3506939160bbp104df9jsn0ec64fadde4c'
                    },
                    body: JSON.stringify({
                        language_id: 54, // C++
                        source_code: btoa(source),
                        stdin: btoa(inp)
                    })
                });
                
                const result = await response.json();
                
                // Handle Errors or Success
                if (result.status.id === 3) {
                    statusSpan.className = 'bg-green-600 text-white px-2 py-0.5 rounded-full text-xs';
                    outputBox.textContent = atob(result.stdout || '');
                } else if (result.status.id === 6) {
                    statusSpan.className = 'bg-red-600 text-white px-2 py-0.5 rounded-full text-xs';
                    outputBox.textContent = atob(result.compile_output || '');
                } else {
                    statusSpan.className = 'bg-yellow-600 text-white px-2 py-0.5 rounded-full text-xs';
                    outputBox.textContent = (result.stderr ? atob(result.stderr) + '\n' : '') + (result.stdout ? atob(result.stdout) : '');
                }
                statusSpan.textContent = result.status.description;

            } catch (e) {
                outputBox.textContent = "Error: " + e.message;
            } finally {
                runBtn.disabled = false;
                runBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                runBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/></svg> Run`;
            }
        });
    </script>
</body>
</html>